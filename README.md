# 目录介绍
本目录为AIEdge项目一期交付目录，包含所有源代码以及部署框架与人脸识别示范应用所需的镜像和部署文件：1-5节是对各个子目录包含的内容的介绍，第6节包含一个典型集群部署的部署图，第7节为部署总体流程，在完成集群部署后，继续部署云边数据通道和人脸识别示范应用。

`注意: 由于目录包含linux符号链接，故以AIEDGE.tar的形式交付。通过解包获得交付目录，Windows系统中解包后符号链接会失效，实际部署时候最好在Linux系统中解包。`
## 1 框架
`framework：包括部署k8s, kubeedge, harbor, dashborad, 部署方法详见AIEDGE/framework 文件夹中的README `

 AIEDGE/framework文件夹中的各个子文件夹作用如下：
- README.md 部署k8s, kubeedge, harbor 的详细说明
- k8s：k8s部署相关脚本
- kubeedge：包含kubeedge源代码和x86平台二进制文件
- dashboard：Web管理界面源码、dashboard部署文件和所需脚本
- harbor：镜像仓库部署

## 2 云边数据通道
`cec：云边数据通道源代码和部署文件，该目录下有相应的README`

      云边数据通道是AIEdge框架为解决边缘应用和云端进行数据传输所开发的基础设施。Kubeedge解决方案本身实现了云计算能力前移，即把Pod的部署能力从k8s云端集群前移到边缘节点上，并且能在控制层面上解决网络边缘网络复杂性问题，实现内网穿透和离线自治，其实现方式是建立边缘端与云端cloudcore服务进程的一条长连接，其数据传输也使用这条长连接。这种实现方式的问题在于只适合诸如IOT设备一类的小规模数据传输，不适合大规模通用二进制数据传输，会造成cloudcore的单点性能瓶颈。因此开发一套基础设施解决数据层面上边缘网络的复杂性问题是必要的，云边数据通道由此而来。
      云边数据通道(Cloud Edge data Channel，简称CEC，部署在云端的部分简称CECC，部署在边缘端的部分简称CECE), CECC部署在k8s核心集群中，起到核心中继的作用，目前以消息队列的方式实现，采用的后端为rocketmq，rocketmq本身经受过阿里双11业务考验，相比市面上其他的消息队列产品具有很好的性能和稳定性。用户的云端应用可以通过CECC SDK接入云边数据通道，用于接收来在边缘应用的数据，或传输数据到边缘应用。
      CECE被部署在集群的每个边缘局域网内，在每个局域网内至少部署一个CECE服务，也可以部署多个起到负载均衡的作用。其主要功能有两点，一是类似CECC，让用户应用通过CECE SDK接入云边数据通道，进行业务所需的数据传输，二是可以起到流量汇聚并处理的作用，在边缘局域网内进行诸如用户流量审计等数据处理工作，由于处理需求多样且需求尚不明了，目前用户应用流量汇聚到CECE后不进行任何处理，后续根据实际需求可以插件化开发处理插件。

## 3 适配容器
`mapper：适配容器源代码和部署文件，该目录下有相应的README`

      适配容器(mapper)为AIEdge框架提供的解决边缘设备接入方案的基础设施。
      kubeedge框架中提供对边缘设备的访问控制能力（如访问设备状态及元信息、向设备发送开关等控制命令）。但这种能力没有将控制流与数据流分开。我们的mapper一方面利用kubeedge提供的能力作为边缘设备控制流传输，另一方面对边缘应用提供了访问边缘设备的接口。这种架构下，边缘设备的控制流走k8s与kubeedge提供的控制通道，数据流通过边缘应用走云边数据通道传入云端。
      mapper在每个边缘节点都有部署，边缘应用通过访问相应的,mapper来达到访问边缘设备的目的。边缘应用与mapper的访问通过网络来实现，服务发现通过本地共享卷来实现，这一整套服务发现与访问机制的功能都通过mapper的应用开发者库来提供。当应用需要使用边缘设备时，需要在部署应用的边缘节点部署mapper，然后部署边缘应用，边缘应用通过部署的mapper访问边缘设备。
      对于每种协议的边缘设备，都需要一种mapper来进行适配。后续可以根据实际需求针对不同边缘设备开发不同的mapper来进行边缘设备适配。
## 4 人脸识别示范应用
`demo_app：人脸识别示范应用的镜像和部署文件，该目录下有相应的README`

      人脸识别示范应用是开发在AIEdge框架上的示范性AI应用。在通常的人脸识别流程中包含视频流接收获取图像帧、人脸检测、特征提取、比对和存储识别结果等流程，在典型的云计算场景下，这套流程被全部部署在云端，用户使用客户端传输视频流或图片到云端，云端执行上述整个流程。在这种场景下，随着应用规模变大，云端将面临很大的数据传输和计算压力。
      AIEdge智能边缘计算框架可以很好地解决这类问题，在AIEdge平台上部署的人脸识别示范应用将以上流程划分为两个部分，分别部署在边缘端和云端，即人脸识别的前置计算，包括视频流接收获取图像帧、人脸检测和特征提取被以边缘应用的方式部署到边缘节点，其余的部分以云端应用部署到云端节点, 以云边协同的方式完成人脸识别业务所需要的整个流程。这种处理流程的优势在于由被前置到边缘的应用进行人脸检测和特征提取，后续只需传输少量的抓拍图片和以及获得的人脸特征到云端，云端应用不再需要进行这些流程，只需对获得的特征进行比对和存储，而且需要传输的数据量大大减少，极大地减轻了数据传输和计算压力。

## 5 scripts 部署AIEDGE应用的相关脚本和yaml文件
`scripts:部署整个AIEdge框架所需脚本，除了部署k8s-kubeedge集群和Web管理界面，还包括对云边数据通道、适配容器和人脸识别示范应用的部署脚本,具体使用流程请查看scripts文件夹中的README`

        scripts中一些文件或目录采用符号链接的方式链接到cec、mapper和demo_app目录中，而这几个目录中的许多镜像部署都需要根据实际环境修改yaml文件（如需要修改yaml文件中nodeSelecotr来修改部署节点），目前的部署脚本尚未做到交互式自动化部署，因此需要到各个目录下进行适应性修改才可以用scripts中的脚本进行部署，脚本中一般有相应注释告知需要修改哪些内容
## 6 AIEDGE部署图
`下图为AIEDGE的部署图，是集群部署的示例，该部署图包括5个节点，一个k8s master 节点，一个k8s worker 节点，还有两个kubeedge边缘节点，再加一个harbor镜像仓库所在的节点`

![](https://github.com/ningyijian/AiEdge/blob/master/部署图.png)

## 7 部署AIEDGE流程图 （看流程图部署时，请与对应的README文件一同阅读)
` 下图为部署AIEDGE的流程图，白色矩形框是对流程图的一些说明，红色字体解释了本图中的一些细节，颜色说明解释了每种颜色所代表的含义，在本图中就是指需要修改的文件，每个流程图矩形框下面都有表明，这个流程所涉及的文件夹，以及文件夹中需要修改的文件。流程图上面都有执行该流程需要查看的README文件所在的位置。`
![](https://github.com/ningyijian/AiEdge/blob/master/部署AIEDGE流程图.png)

[1]: https://github.com/ningyijian/AiEdge/blob/master/部署图.png
[2]: https://github.com/ningyijian/AiEdge/blob/master/部署AIEDGE流程图.png